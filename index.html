<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Block Builder</title>

    <script src="https://courses.vipmembervault.com/fe/js/vue.min.js"></script>
    <script src="https://courses.vipmembervault.com/fe/js/jquery-3.6.0.min.js"></script>
    <script src="https://courses.vipmembervault.com/fe/js/tinymce/tinymce.min.js"></script>
    <script src="scripts.js"></script>

    <link href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css" rel="stylesheet">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.css" integrity="sha512-5A8nwdMOWrSz20fDsjczgUidUBR8liPYU+WymTZP1lmY9G6Oc7HlZv156XqnsgNUzTyMefFTcsFH/tnJE/+xBg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
</head>
<body>

    <div class="w-full">
    <div class="w-1/2 float-left">
    
        <div id="block_editor_page" class="relative w-full p-4 bg-gray-200 rounded-md">
            <mv-block
                v-for="(block, index) in blocks"
                :index="index"
                :key="index"
                :id="block.id"
                @delete-block="deleteBlock"
                @update-block="updateBlock"
            >
            </mv-block>

            <button class="relative mt-4 cursor-pointer w-full" @click="addBlock">Add Block</button>
        </div>

    </div>

    <div class="w-1/2 float-left p-8">
        <h1>Blocks Data</h1>
        <hr>
        <div id="block_data"></div>
    </div>

    </div>


    <script type="text/x-template" id="block_template">

        <div class="w-full flex bg-white p-2">
            <div class="flex-initial w-8 pt-1">
                <i class="fa fa-arrows w-full" aria-hidden="true"></i>
                <i class="fa fa-floppy-o w-full mt-2" aria-hidden="true" @click="saveBlock"></i>                
                <i class="fa fa-trash-o w-full mt-2" aria-hidden="true" @click="deleteBlock"></i>

                <!--<i class="fa fa-cog w-full mt-2" aria-hidden="true" ></i>-->

            </div>
            <div class="flex-auto bg-gray-100 p-4">
                <textarea name="description" v-model="description" @change="keymonitor" class="form-control tinymce"></textarea>
            </div>
        </div>

    </script>

    <script>
        new Vue({
            el: '#block_editor_page',
            data: {
                blocks: []
            },
            methods: {
                addBlock: function( event ){
                    this.blocks.push( { } );
                    this.saveBlocks();
                },
                saveBlocks: function() {
                    console.log( JSON.stringify( this.blocks ) );
                    $('#block_data').html( JSON.stringify( this.blocks ) );
                },
                deleteBlock: function( payload ) {
                    if ( confirm( 'Are you sure you want to delete this block?' ) ) {
                        //this.deleteAction( this.user_actions[ payload.index ].id );
                        this.$delete( this.blocks, payload.index );
                        this.saveBlocks();
                    } else {
                        //this.user_actions[ payload.index ].trigger = 'user_create_account';
                    }
                },
                updateBlock: function( payload ) {
                    console.log( payload.content );
                    this.blocks[payload.index] = payload.content;
                    this.saveBlocks();
                },

            }
        });
    </script>

    <script>
        Vue.component('mv-block', {
            template: '#block_template',
            props: ['id','index'],
            data () {
                return {
                    description: ''
                };
            },
            mounted(){
                //initTinyMCE();
            },
            methods: {
                saveBlock: function( event ) {
                    console.log('save block');
                    tinyMCE.triggerSave();
                    this.$emit('update-block', { index: this.index, content: this.description } );
                },
                keymonitor: function( event ) {
                    console.log('changed text');
                    this.$emit('update-block', { index: this.index, content: this.description } );
                },
                deleteBlock: function( event ) {
                    this.$emit('delete-block', { index: this.index } );
                },
            }
        });
    </script>


</body>
</html>